<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù‚ÛŒÙ…Øª Ù‚Ø·Ø¹Ø§Øª</title>
    <style>
        :root { --primary-color: #2c3e50; --sec-color: #27ae60; }
        body { font-family: Tahoma, Geneva, sans-serif; margin: 0; padding: 15px; background: #eef2f3; color: #333; }
        .container { max-width: 100%; margin: 0 auto; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù‡Ø¯Ø± Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© */
        .site-header { 
            text-align: center; background: var(--primary-color); color: white; 
            padding: 20px; border-radius: 12px; margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .site-header h1 { margin: 0; font-size: 22px; }

        .controls { 
            background: white; padding: 15px; border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;
            position: sticky; top: 10px; z-index: 100;
        }

        .input-group { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        input { padding: 10px; border: 2px solid #ddd; border-radius: 8px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--sec-color); }
        #searchInput { flex-grow: 1; min-width: 250px; }

        .table-container { 
            background: white; border-radius: 12px; overflow: auto; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); max-height: 65vh;
        }
        
        table { border-collapse: collapse; width: 100%; min-width: 1000px; font-size: 13px; }
        thead th { 
            position: sticky; top: 0; background: #34495e; 
            color: white; z-index: 10; padding: 12px 8px; text-align: right;
            border: 1px solid #2c3e50;
        }
        td { padding: 10px 8px; border-bottom: 1px solid #eee; white-space: nowrap; }
        tbody tr:nth-child(even) { background-color: #f8f9fa; }
        tbody tr:hover { background-color: #e1f5fe; }
        .model-cell { font-weight: bold; color: #1a237e; border-left: 2px solid #eee; width: 100px; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ ÙÙˆØªØ± Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© */
        .site-footer { 
            margin-top: 20px; background: #fff; padding: 15px; 
            border-radius: 12px; text-align: center; font-size: 14px;
            border-top: 4px solid var(--sec-color); color: #555; line-height: 1.6;
        }

        .status-bar { font-size: 11px; margin-top: 10px; color: #888; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="site-header">
        <h1 id="mainTitle">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</h1>
    </div>

    <div class="controls">
        <div class="input-group">
            <input type="hidden" id="dollarRate"> 
            <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø¯Ù„..." oninput="updatePrices()">
            <button onclick="fetchData()" style="padding: 10px; cursor: pointer; background: var(--sec-color); color: white; border: none; border-radius: 8px;">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
        </div>
        <div id="loadStatus" class="status-bar">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...</div>
    </div>

    <div id="results" class="table-container"></div>

    <div id="siteFooter" class="site-footer"></div>
</div>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR6ZMpcmL_R5E8m9IOYJNOp-bTKbTq4AnPfe_17bbeIM-wRoORJEh3b-1bPX-JQ42c5Ol7jb8ZOm4WI/pub?output=csv'; 
    let allData = [];
    let headers = [];

    async function fetchData() {
        try {
            const response = await fetch(sheetUrl + "&t=" + new Date().getTime());
            const text = await response.text();
            const rows = text.split('\n').map(r => r.split(','));

            // Û±. Ù†Ø±Ø® Ø¯Ù„Ø§Ø± Ø§Ø² B1
            document.getElementById('dollarRate').value = rows[0][1].replace(/,/g, '').trim();

            // Û². ØªÛŒØªØ± Ù‡Ø¯Ø± Ø§Ø² D1 (Ø³ØªÙˆÙ† Ú†Ù‡Ø§Ø±Ù…)
            if(rows[0][3]) document.getElementById('mainTitle').innerText = rows[0][3].trim();

            // Û³. Ù…ØªÙ† ÙÙˆØªØ± Ø§Ø² F1 (Ø³ØªÙˆÙ† Ø´Ø´Ù…)
            if(rows[0][5]) document.getElementById('siteFooter').innerText = rows[0][5].trim();

            // Û´. Ø³Ø±Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ Ø§Ø² Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ…
            headers = rows[1].slice(1).map(h => h.trim());

            // Ûµ. Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø·Ø¹Ø§Øª Ø§Ø² Ø±Ø¯ÛŒÙ Ø³ÙˆÙ…
            allData = [];
            for(let i = 2; i < rows.length; i++) {
                if(rows[i][0] && rows[i][0].trim() !== "") {
                    allData.push({
                        model: rows[i][0].trim(),
                        prices: rows[i].slice(1).map(p => parseFloat(p) || 0)
                    });
                }
            }
            document.getElementById('loadStatus').innerText = "Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: " + new Date().toLocaleTimeString('fa-IR');
            updatePrices();
        } catch (e) {
            document.getElementById('loadStatus').innerText = "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª!";
        }
    }

    function updatePrices() {
        const rate = parseFloat(document.getElementById('dollarRate').value) || 0;
        const searchClean = document.getElementById('searchInput').value.toLowerCase().replace(/\s+/g, '');

        const filtered = allData.filter(item => item.model.toLowerCase().replace(/\s+/g, '').includes(searchClean));

        let tableHTML = `<table><thead><tr><th class="model-cell">ğŸ“± Ù…Ø¯Ù„</th>`;
        headers.forEach(h => { if(h) tableHTML += `<th>${h}</th>`; });
        tableHTML += `</tr></thead><tbody>`;

        filtered.forEach(item => {
            tableHTML += `<tr><td class="model-cell">${item.model}</td>`;
            item.prices.forEach((p, index) => {
                if(index < headers.length && headers[index]) {
                    const final = p * rate;
                    tableHTML += `<td>${p > 0 ? Math.round(final).toLocaleString('fa-IR') : '---'}</td>`;
                }
            });
            tableHTML += `</tr>`;
        });

        tableHTML += `</tbody></table>`;
        document.getElementById('results').innerHTML = tableHTML;
    }

    fetchData();
</script>

</body>
</html>
