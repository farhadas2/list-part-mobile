<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‚ÛŒÙ…Øª Ù‚Ø·Ø¹Ø§Øª</title>
    <style>
        :root { --primary-color: #2c3e50; --sec-color: #27ae60; }
        body { font-family: Tahoma, Geneva, sans-serif; margin: 0; padding: 15px; background: #eef2f3; color: #333; }
        .container { max-width: 100%; margin: 0 auto; }
        
        .controls { 
            background: white; padding: 15px; border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;
            position: sticky; top: 10px; z-index: 100;
        }

        .input-group { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        input { padding: 10px; border: 2px solid #ddd; border-radius: 8px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--sec-color); }
        #dollarRate { width: 120px; font-weight: bold; color: #d35400; background: #fff5e6; }
        #searchInput { flex-grow: 1; min-width: 250px; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÙˆÙ„ */
        .table-container { 
            background: white; border-radius: 12px; overflow: auto; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); max-height: 75vh;
        }
        
        table { border-collapse: collapse; width: 100%; min-width: 1000px; font-size: 13px; }
        
        /* ÙØ±ÛŒØ² Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„ */
        thead th { 
            position: sticky; top: 0; background: var(--primary-color); 
            color: white; z-index: 10; padding: 12px 8px; text-align: right;
            resize: horizontal; overflow: auto; /* Ù‚Ø§Ø¨Ù„ÛŒØª ØªØºÛŒÛŒØ± Ø³Ø§ÛŒØ² Ø³ØªÙˆÙ† */
            border: 1px solid #34495e;
        }

        td { padding: 8px; border-bottom: 1px solid #eee; white-space: nowrap; }
        
        /* Ø±Ù†Ú¯ Ø¨Ù†Ø¯ÛŒ ÛŒÚ© Ø¯Ø± Ù…ÛŒØ§Ù† */
        tbody tr:nth-child(even) { background-color: #f8f9fa; }
        tbody tr:hover { background-color: #e1f5fe; }

        .model-cell { 
            font-weight: bold; color: #1a237e; border-left: 2px solid #eee;
            width: 150px; /* Ú©Ù…ØªØ± Ú©Ø±Ø¯Ù† ÙØ§ØµÙ„Ù‡ Ù…Ø¯Ù„ */
        }

        .status-bar { font-size: 12px; margin-top: 10px; color: #666; }
        .price-val { color: #2e7d32; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="controls">
        <div class="input-group">
            <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø¯Ù„ (Ù…Ø«Ù„Ø§Ù‹ note 8 ÛŒØ§ note8)..." oninput="updatePrices()">
            <button onclick="fetchData()" style="padding: 10px; cursor: pointer;">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø² Ø´ÛŒØª</button>
        </div>
        <div id="loadStatus" class="status-bar">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...</div>
    </div>

    <div id="results" class="table-container">
        </div>
</div>

<script>
    // Ø¢Ø¯Ø±Ø³ CSV Ú¯ÙˆÚ¯Ù„ Ø´ÛŒØª Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯
    const sheetUrl = 'Https://docs.google.com/spreadsheets/d/e/2PACX-1vR6ZMpcmL_R5E8m9IOYJNOp-bTKbTq4AnPfe_17bbeIM-wRoORJEh3b-1bPX-JQ42c5Ol7jb8ZOm4WI/pub?output=csv'; 
    let allData = [];
    let headers = [];

    async function fetchData() {
        const statusEl = document.getElementById('loadStatus');
        statusEl.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ú¯ÙˆÚ¯Ù„ Ø´ÛŒØª...";
        
        try {
            const response = await fetch(sheetUrl + "&t=" + new Date().getTime());
            const text = await response.text();
            const rows = text.split('\n').map(r => r.split(','));

            // Û±. Ù†Ø±Ø® Ø¯Ù„Ø§Ø± Ø§Ø² Ø³Ù„ÙˆÙ„ B1
            const dollarRate = rows[0][1].replace(/,/g, '').trim();
            document.getElementById('dollarRate').value = dollarRate;

            // Û². ØªÛŒØªØ±Ù‡Ø§ Ø§Ø² Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ…
            headers = rows[1].slice(1);

            // Û³. Ù…Ø¯Ù„â€ŒÙ‡Ø§ Ø§Ø² Ø±Ø¯ÛŒÙ Ø³ÙˆÙ… Ø¨Ù‡ Ø¨Ø¹Ø¯
            allData = [];
            for(let i = 2; i < rows.length; i++) {
                if(rows[i][0] && rows[i][0].trim() !== "") {
                    allData.push({
                        model: rows[i][0].trim(),
                        prices: rows[i].slice(1).map(p => parseFloat(p) || 0)
                    });
                }
            }
            statusEl.innerText = "Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: " + new Date().toLocaleTimeString('fa-IR');
            updatePrices();
        } catch (e) {
            statusEl.innerText = "Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„! Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ†ØªØ±Ù†Øª Ùˆ Ù„ÛŒÙ†Ú© Ø´ÛŒØª Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯.";
        }
    }

    function updatePrices() {
        const rate = parseFloat(document.getElementById('dollarRate').value) || 0;
        const rawSearch = document.getElementById('searchInput').value.toLowerCase();
        
        // Ø±ÙØ¹ Ù…Ø´Ú©Ù„ ÙØ§ØµÙ„Ù‡ Ø¯Ø± Ø³Ø±Ú† (Ø­Ø°Ù ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ù†Ø¹Ø·Ù)
        const searchClean = rawSearch.replace(/\s+/g, '');

        const filtered = allData.filter(item => {
            const modelClean = item.model.toLowerCase().replace(/\s+/g, '');
            return modelClean.includes(searchClean);
        });

        let tableHTML = `<table><thead><tr><th class="model-cell">ğŸ“± Ù…Ø¯Ù„</th>`;
        headers.forEach(h => tableHTML += `<th>${h}</th>`);
        tableHTML += `</tr></thead><tbody>`;

        filtered.forEach(item => {
            tableHTML += `<tr><td class="model-cell">${item.model}</td>`;
            item.prices.forEach(p => {
                const finalPrice = p * rate;
                tableHTML += `<td>${p > 0 ? (Math.round(finalPrice)).toLocaleString('fa-IR') : '---'}</td>`;
            });
            tableHTML += `</tr>`;
        });

        tableHTML += `</tbody></table>`;
        document.getElementById('results').innerHTML = tableHTML;
    }

    // Ø´Ø±ÙˆØ¹ Ø®ÙˆØ¯Ú©Ø§Ø±
    fetchData();
</script>

</body>
</html>
